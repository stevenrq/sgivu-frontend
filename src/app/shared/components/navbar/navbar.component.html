<nav class="topbar">
  <div class="topbar__brand">
    <div class="brand-mark">
      <i class="bi bi-ev-front-fill"></i>
    </div>
    <div class="brand-copy d-lg-none">
      <span class="brand-title">SGIVU</span>
    </div>
  </div>

  <button
    class="topbar__toggle"
    type="button"
    (click)="toggleMenu()"
    aria-controls="sgivuNavbar"
    [attr.aria-expanded]="isMenuOpen"
    aria-label="Alternar navegación"
  >
    <i class="bi" [ngClass]="isMenuOpen ? 'bi-x-lg' : 'bi-list'"></i>
  </button>

  <div
    #navbarCollapse
    class="topbar__menu collapse show"
    id="sgivuNavbar"
    [class.show]="!isMobileView || isMenuOpen"
  >
    <ul class="topbar__links">
      <li>
        <a
          class="topbar__link"
          routerLink="/dashboard"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
          (click)="handleNavigation()"
        >
          <i class="bi bi-speedometer2"></i>
          <span>Panel</span>
        </a>
      </li>
      <li>
        <a
          class="topbar__link"
          routerLink="/vehicles"
          routerLinkActive="active"
          (click)="handleNavigation()"
        >
          <i class="bi bi-truck-front"></i>
          <span>Vehículos</span>
        </a>
      </li>
      <li>
        <a
          class="topbar__link"
          routerLink="/clients"
          routerLinkActive="active"
          (click)="handleNavigation()"
        >
          <i class="bi bi-people"></i>
          <span>Clientes</span>
        </a>
      </li>
      <li>
        <a
          class="topbar__link"
          routerLink="/purchase-sales"
          routerLinkActive="active"
          (click)="handleNavigation()"
        >
          <i class="bi bi-receipt-cutoff"></i>
          <span>Compras y Ventas</span>
        </a>
      </li>
      <li>
        <a
          class="topbar__link"
          routerLink="/roles-permissions"
          routerLinkActive="active"
          (click)="handleNavigation()"
        >
          <i class="bi bi-file-earmark-bar-graph-fill"></i>
          <span>Reportes</span>
        </a>
      </li>
    </ul>

    @if (isAuthenticated$ | async) {
      @if (user$ | async; as user) {
        <div class="dropdown topbar__profile">
          <button
            class="topbar__profile-btn dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <div class="avatar" aria-hidden="true">
              {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
            </div>
            <div class="user-info">
              <strong>{{ user.username }}</strong>
            </div>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <a
                class="dropdown-item"
                routerLink="/users/profile"
                (click)="handleNavigation()"
                >Mi Perfil</a
              >
            </li>
            <li>
              <a
                class="dropdown-item"
                routerLink="/settings"
                (click)="handleNavigation()"
                >Configuración</a
              >
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <button class="dropdown-item" type="button" (click)="logout()">
                Cerrar sesión
              </button>
            </li>
          </ul>
        </div>
      }
    } @else {
      <div class="topbar__loading" role="status" aria-label="Cargando">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
    }
  </div>
</nav>
