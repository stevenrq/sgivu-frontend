<div class="vehicle-form-wrapper">
  <div class="card shadow-sm position-relative">
    @if (isLoading()) {
      <div class="loading-overlay">
        <div class="spinner-border text-primary">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>
    }

    <div class="card-header bg-light border-bottom-0">
      <h1 class="h4 text-dark mb-1 d-flex align-items-center">
        <i
          class="bi me-2"
          [ngClass]="isCar ? 'bi-car-front-fill' : 'bi-bicycle'"
        ></i>
        {{ titleText }}
      </h1>
      <p class="text-muted mb-0">
        {{ subtitleText }}
      </p>
    </div>

    <div class="card-body p-4">
      <form [formGroup]="formGroup" (ngSubmit)="onSubmit()" novalidate>
        <fieldset class="border rounded p-3 mb-4">
          <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
            <i class="bi bi-card-text me-1"></i>Información general
          </legend>
          <div class="row g-3 mt-0">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="brand"
                  placeholder="Marca"
                  formControlName="brand"
                  [ngClass]="{ 'is-invalid': formGroup.get('brand')?.invalid && (formGroup.get('brand')?.dirty || formGroup.get('brand')?.touched) }"
                />
                <label for="brand"><i class="bi bi-award me-2"></i>Marca</label>
                <div class="invalid-feedback">
                  La marca es requerida y debe tener entre 2 y 20 caracteres.
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="model"
                  placeholder="Modelo"
                  formControlName="model"
                  [ngClass]="{ 'is-invalid': formGroup.get('model')?.invalid && (formGroup.get('model')?.dirty || formGroup.get('model')?.touched) }"
                />
                <label for="model"><i class="bi bi-speedometer2 me-2"></i>Modelo</label>
                <div class="invalid-feedback">
                  El modelo es requerido.
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="line"
                  placeholder="Línea"
                  formControlName="line"
                  [ngClass]="{ 'is-invalid': formGroup.get('line')?.invalid && (formGroup.get('line')?.dirty || formGroup.get('line')?.touched) }"
                />
                <label for="line"><i class="bi bi-diagram-3-fill me-2"></i>Línea</label>
                <div class="invalid-feedback">La línea es requerida.</div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="border rounded p-3 mb-4">
          <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
            <i class="bi bi-upc-scan me-1"></i>Identificación
          </legend>
          <div class="row g-3 mt-0">
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control text-uppercase"
                  id="plate"
                  placeholder="Placa"
                  formControlName="plate"
                  [readonly]="isEditMode"
                  [ngClass]="{ 'is-invalid': formGroup.get('plate')?.invalid && (formGroup.get('plate')?.dirty || formGroup.get('plate')?.touched) }"
                />
                <label for="plate"><i class="bi bi-hash me-2"></i>Placa</label>
                <div class="invalid-feedback">
                  Ingrese una placa válida (solo letras, números y guiones).
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="motorNumber"
                  placeholder="Número de motor"
                  formControlName="motorNumber"
                  [ngClass]="{ 'is-invalid': formGroup.get('motorNumber')?.invalid && (formGroup.get('motorNumber')?.dirty || formGroup.get('motorNumber')?.touched) }"
                />
                <label for="motorNumber"
                  ><i class="bi bi-gear-wide-connected me-2"></i>Número de
                  motor</label
                >
                <div class="invalid-feedback">
                  El número de motor es requerido.
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="serialNumber"
                  placeholder="Número serial"
                  formControlName="serialNumber"
                  [ngClass]="{ 'is-invalid': formGroup.get('serialNumber')?.invalid && (formGroup.get('serialNumber')?.dirty || formGroup.get('serialNumber')?.touched) }"
                />
                <label for="serialNumber"
                  ><i class="bi bi-upc me-2"></i>Número serial</label
                >
                <div class="invalid-feedback">
                  El número serial es requerido.
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="chassisNumber"
                  placeholder="Número de chasis"
                  formControlName="chassisNumber"
                  [ngClass]="{ 'is-invalid': formGroup.get('chassisNumber')?.invalid && (formGroup.get('chassisNumber')?.dirty || formGroup.get('chassisNumber')?.touched) }"
                />
                <label for="chassisNumber"
                  ><i class="bi bi-diagram-2-fill me-2"></i>Número de
                  chasis</label
                >
                <div class="invalid-feedback">
                  El número de chasis es requerido.
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="border rounded p-3 mb-4">
          <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
            <i class="bi bi-tools me-1"></i>Características técnicas
          </legend>
          <div class="row g-3 mt-0">
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="capacity"
                  placeholder="Capacidad"
                  formControlName="capacity"
                  [ngClass]="{ 'is-invalid': formGroup.get('capacity')?.invalid && (formGroup.get('capacity')?.dirty || formGroup.get('capacity')?.touched) }"
                />
                <label for="capacity"
                  ><i class="bi bi-people-fill me-2"></i>Capacidad (ocupantes)</label
                >
                <div class="invalid-feedback">
                  Ingrese una capacidad válida (mínimo 1).
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="color"
                  placeholder="Color"
                  formControlName="color"
                  [ngClass]="{ 'is-invalid': formGroup.get('color')?.invalid && (formGroup.get('color')?.dirty || formGroup.get('color')?.touched) }"
                />
                <label for="color"><i class="bi bi-palette me-2"></i>Color</label>
                <div class="invalid-feedback">El color es requerido.</div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="cityRegistered"
                  placeholder="Ciudad"
                  formControlName="cityRegistered"
                  [ngClass]="{ 'is-invalid': formGroup.get('cityRegistered')?.invalid && (formGroup.get('cityRegistered')?.dirty || formGroup.get('cityRegistered')?.touched) }"
                />
                <label for="cityRegistered"
                  ><i class="bi bi-geo-alt-fill me-2"></i>Ciudad de registro</label
                >
                <div class="invalid-feedback">
                  La ciudad es requerida.
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="year"
                  placeholder="Año"
                  formControlName="year"
                  [ngClass]="{ 'is-invalid': formGroup.get('year')?.invalid && (formGroup.get('year')?.dirty || formGroup.get('year')?.touched) }"
                />
                <label for="year"><i class="bi bi-calendar3 me-2"></i>Año</label>
                <div class="invalid-feedback">
                  Ingrese un año entre 1950 y 2050.
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="mileage"
                  placeholder="Kilometraje"
                  formControlName="mileage"
                  [ngClass]="{ 'is-invalid': formGroup.get('mileage')?.invalid && (formGroup.get('mileage')?.dirty || formGroup.get('mileage')?.touched) }"
                />
                <label for="mileage"
                  ><i class="bi bi-tachometer me-2"></i>Kilometraje</label
                >
                <div class="invalid-feedback">
                  Ingrese un valor válido de kilometraje.
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="transmission"
                  placeholder="Transmisión"
                  formControlName="transmission"
                  [ngClass]="{ 'is-invalid': formGroup.get('transmission')?.invalid && (formGroup.get('transmission')?.dirty || formGroup.get('transmission')?.touched) }"
                />
                <label for="transmission"
                  ><i class="bi bi-boxes me-2"></i>Transmisión</label
                >
                <div class="invalid-feedback">
                  La transmisión es requerida.
                </div>
              </div>
            </div>

            @if (isCar) {
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="bodyType"
                    placeholder="Tipo de carrocería"
                    formControlName="bodyType"
                    [ngClass]="{ 'is-invalid': formGroup.get('bodyType')?.invalid && (formGroup.get('bodyType')?.dirty || formGroup.get('bodyType')?.touched) }"
                  />
                  <label for="bodyType"
                    ><i class="bi bi-car-front me-2"></i>Tipo de carrocería</label
                  >
                  <div class="invalid-feedback">
                    La carrocería es requerida.
                  </div>
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="fuelType"
                    placeholder="Tipo de combustible"
                    formControlName="fuelType"
                    [ngClass]="{ 'is-invalid': formGroup.get('fuelType')?.invalid && (formGroup.get('fuelType')?.dirty || formGroup.get('fuelType')?.touched) }"
                  />
                  <label for="fuelType"
                    ><i class="bi bi-fuel-pump me-2"></i>Tipo de combustible</label
                  >
                  <div class="invalid-feedback">
                    El tipo de combustible es requerido.
                  </div>
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="numberOfDoors"
                    placeholder="Número de puertas"
                    formControlName="numberOfDoors"
                    [ngClass]="{ 'is-invalid': formGroup.get('numberOfDoors')?.invalid && (formGroup.get('numberOfDoors')?.dirty || formGroup.get('numberOfDoors')?.touched) }"
                  />
                  <label for="numberOfDoors"
                    ><i class="bi bi-chevron-bar-contract me-2"></i>Número de
                    puertas</label
                  >
                  <div class="invalid-feedback">
                    Indique un número de puertas entre 2 y 6.
                  </div>
                </div>
              </div>
            }

            @if (isMotorcycle) {
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="motorcycleType"
                    placeholder="Tipo de motocicleta"
                    formControlName="motorcycleType"
                    [ngClass]="{ 'is-invalid': formGroup.get('motorcycleType')?.invalid && (formGroup.get('motorcycleType')?.dirty || formGroup.get('motorcycleType')?.touched) }"
                  />
                  <label for="motorcycleType"
                    ><i class="bi bi-bicycle me-2"></i>Tipo de motocicleta</label
                  >
                  <div class="invalid-feedback">
                    El tipo de motocicleta es requerido.
                  </div>
                </div>
              </div>
            }
          </div>
        </fieldset>

        <fieldset class="border rounded p-3 mb-4">
          <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
            <i class="bi bi-cash-stack me-1"></i>Valores comerciales
          </legend>
          <div class="row g-3 mt-0">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="purchasePrice"
                  placeholder="Precio de compra"
                  formControlName="purchasePrice"
                  [ngClass]="{ 'is-invalid': formGroup.get('purchasePrice')?.invalid && (formGroup.get('purchasePrice')?.dirty || formGroup.get('purchasePrice')?.touched) }"
                />
                <label for="purchasePrice"
                  ><i class="bi bi-cash me-2"></i>Precio de compra</label
                >
                <div class="invalid-feedback">
                  Ingrese un valor válido (>= 0).
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="salePrice"
                  placeholder="Precio de venta"
                  formControlName="salePrice"
                  [ngClass]="{ 'is-invalid': formGroup.get('salePrice')?.invalid && (formGroup.get('salePrice')?.dirty || formGroup.get('salePrice')?.touched) }"
                />
                <label for="salePrice"
                  ><i class="bi bi-bank me-2"></i>Precio de venta</label
                >
                <div class="invalid-feedback">
                  Ingrese un valor válido (>= 0).
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="status"
                  formControlName="status"
                >
                  @for (status of statuses; track status) {
                    <option [value]="status">{{ status }}</option>
                  }
                </select>
                <label for="status"
                  ><i class="bi bi-flag-fill me-2"></i>Estado actual</label
                >
              </div>
            </div>
          </div>

          <div class="row g-3 mt-0 align-items-center">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="url"
                  class="form-control"
                  id="photoUrl"
                  placeholder="URL de la fotografía"
                  formControlName="photoUrl"
                />
                <label for="photoUrl"
                  ><i class="bi bi-image me-2"></i>URL de fotografía
                  (opcional)</label
                >
              </div>
            </div>
          </div>
        </fieldset>

        <div class="d-flex justify-content-between align-items-center mt-4">
          <button type="button" class="btn btn-outline-secondary" (click)="goBack()">
            <i class="bi bi-arrow-left me-2"></i>Volver al listado
          </button>

          <button class="btn btn-primary" type="submit">
            <i class="bi bi-save me-2"></i>
            {{ isEditMode ? 'Guardar cambios' : 'Registrar vehículo' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
