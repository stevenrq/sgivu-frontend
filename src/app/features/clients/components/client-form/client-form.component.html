<div class="d-flex vh-100">
  <div class="flex-grow-1 d-flex flex-column">
    <main class="flex-grow-1 p-4 client-form-page">
      <div class="container-fluid">
        <div class="card shadow-sm border-0 position-relative client-form-card">
          @if (isLoading()) {
            <div class="loading-overlay">
              <div class="spinner-border text-primary">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
          }

          <div class="card-header border-bottom-0 pt-3 client-form-header">
            <h1 class="h4 mb-1 d-flex align-items-center client-form-title">
              <i class="bi me-2" [ngClass]="headerIcon"></i>
              {{ titleText }}
            </h1>
            <p class="mb-0 client-form-subtitle">
              {{ subtitleText }}
            </p>
          </div>

          <div class="card-body p-4">
            <form
              class="floating-google"
              [formGroup]="formGroup"
              (ngSubmit)="onSubmit()"
            >
              <div class="client-type-toggle d-flex align-items-center mb-4">
                <span class="text-muted me-3 fw-semibold">Tipo de cliente</span>
                <div class="btn-group" aria-label="Selector de tipo de cliente">
                  <input
                    type="radio"
                    class="btn-check"
                    id="clientTypePerson"
                    formControlName="type"
                    [value]="'PERSON'"
                    name="type"
                    [disabled]="isEditMode"
                  />
                  <label
                    class="btn btn-outline-primary"
                    [class.active]="clientType === 'PERSON'"
                    for="clientTypePerson"
                  >
                    <i class="bi bi-person-badge me-2"></i>Persona natural
                  </label>

                  <input
                    type="radio"
                    class="btn-check"
                    id="clientTypeCompany"
                    formControlName="type"
                    [value]="'COMPANY'"
                    name="type"
                    [disabled]="isEditMode"
                  />
                  <label
                    class="btn btn-outline-primary"
                    [class.active]="clientType === 'COMPANY'"
                    for="clientTypeCompany"
                  >
                    <i class="bi bi-buildings me-2"></i>Empresa
                  </label>
                </div>
              </div>

              @if (clientType === "PERSON") {
                <fieldset class="border p-3 pt-2 rounded mb-4">
                  <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
                    <i class="bi bi-person-vcard me-1"></i>Identificación
                    personal
                  </legend>
                  <div class="row g-3 mt-0">
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="nationalId"
                          placeholder="Número de cédula"
                          formControlName="nationalId"
                          [readonly]="isEditMode"
                          [ngClass]="{
                            'is-invalid':
                              nationalId?.invalid &&
                              (nationalId?.dirty || nationalId?.touched),
                          }"
                        />
                        <label for="nationalId"
                          ><i class="bi bi-credit-card-2-front me-2"></i>Número
                          de cédula</label
                        >
                        <div class="invalid-feedback">
                          @if (nationalId?.hasError("required")) {
                            <div>La cédula es requerida.</div>
                          }
                          @if (nationalId?.hasError("pattern")) {
                            <div>Solo se permiten números.</div>
                          }
                          @if (nationalId?.hasError("invalidLength")) {
                            <div>Debe tener entre 7 y 10 dígitos.</div>
                          }
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="firstName"
                          placeholder="Nombres"
                          formControlName="firstName"
                          [ngClass]="{
                            'is-invalid':
                              firstName?.invalid &&
                              (firstName?.dirty || firstName?.touched),
                          }"
                        />
                        <label for="firstName"
                          ><i class="bi bi-person-fill me-2"></i>Nombres</label
                        >
                        <div class="invalid-feedback">
                          @if (firstName?.hasError("required")) {
                            <div>El nombre es requerido.</div>
                          }
                          @if (firstName?.hasError("invalidLength")) {
                            <div>Debe tener entre 3 y 30 caracteres.</div>
                          }
                          @if (firstName?.hasError("whitespace")) {
                            <div>No se permiten espacios en blanco.</div>
                          }
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="lastName"
                          placeholder="Apellidos"
                          formControlName="lastName"
                          [ngClass]="{
                            'is-invalid':
                              lastName?.invalid &&
                              (lastName?.dirty || lastName?.touched),
                          }"
                        />
                        <label for="lastName"
                          ><i class="bi bi-person-lines-fill me-2"></i
                          >Apellidos</label
                        >
                        <div class="invalid-feedback">
                          @if (lastName?.hasError("required")) {
                            <div>El apellido es requerido.</div>
                          }
                          @if (lastName?.hasError("invalidLength")) {
                            <div>Debe tener entre 3 y 40 caracteres.</div>
                          }
                          @if (lastName?.hasError("whitespace")) {
                            <div>No se permiten espacios en blanco.</div>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </fieldset>
              }

              @if (clientType === "COMPANY") {
                <fieldset class="border p-3 pt-2 rounded mb-4">
                  <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
                    <i class="bi bi-building me-1"></i>Información de la empresa
                  </legend>
                  <div class="row g-3 mt-0">
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="taxId"
                          placeholder="NIT / Identificación tributaria"
                          formControlName="taxId"
                          [readonly]="isEditMode"
                          [ngClass]="{
                            'is-invalid':
                              taxId?.invalid &&
                              (taxId?.dirty || taxId?.touched),
                          }"
                        />
                        <label for="taxId"
                          ><i class="bi bi-file-earmark-text me-2"></i>NIT /
                          Identificación</label
                        >
                        <div class="invalid-feedback">
                          @if (taxId?.hasError("required")) {
                            <div>El NIT es requerido.</div>
                          }
                          @if (taxId?.hasError("pattern")) {
                            <div>Solo se permiten números.</div>
                          }
                          @if (taxId?.hasError("invalidLength")) {
                            <div>Debe tener entre 10 y 13 dígitos.</div>
                          }
                        </div>
                      </div>
                    </div>
                    <div class="col-md-8">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="companyName"
                          placeholder="Razón social"
                          formControlName="companyName"
                          [ngClass]="{
                            'is-invalid':
                              companyName?.invalid &&
                              (companyName?.dirty || companyName?.touched),
                          }"
                        />
                        <label for="companyName"
                          ><i class="bi bi-buildings me-2"></i>Razón
                          social</label
                        >
                        <div class="invalid-feedback">
                          @if (companyName?.hasError("required")) {
                            <div>La razón social es requerida.</div>
                          }
                          @if (companyName?.hasError("invalidLength")) {
                            <div>Debe tener entre 3 y 60 caracteres.</div>
                          }
                          @if (companyName?.hasError("whitespace")) {
                            <div>No se permiten espacios en blanco.</div>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </fieldset>
              }

              <fieldset class="border p-3 pt-2 rounded">
                <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
                  <i class="bi bi-telephone-forward me-1"></i>Información de
                  contacto
                </legend>
                <div class="row g-3 mt-0">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="tel"
                        class="form-control"
                        id="phoneNumber"
                        placeholder="Número de teléfono"
                        formControlName="phoneNumber"
                        [ngClass]="{
                          'is-invalid':
                            phoneNumber?.invalid &&
                            (phoneNumber?.dirty || phoneNumber?.touched),
                        }"
                      />
                      <label for="phoneNumber"
                        ><i class="bi bi-telephone me-2"></i>Número de
                        teléfono</label
                      >
                      <div class="invalid-feedback">
                        @if (phoneNumber?.hasError("required")) {
                          <div>El teléfono es requerido.</div>
                        }
                        @if (phoneNumber?.hasError("pattern")) {
                          <div>Solo se permiten números.</div>
                        }
                        @if (phoneNumber?.hasError("invalidLength")) {
                          <div>Debe tener exactamente 10 dígitos.</div>
                        }
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        placeholder="Correo electrónico"
                        formControlName="email"
                        [ngClass]="{
                          'is-invalid':
                            email?.invalid && (email?.dirty || email?.touched),
                        }"
                      />
                      <label for="email"
                        ><i class="bi bi-envelope-at me-2"></i>Correo
                        electrónico</label
                      >
                      <div class="invalid-feedback">
                        @if (email?.hasError("required")) {
                          <div>El correo es requerido.</div>
                        }
                        @if (email?.hasError("email")) {
                          <div>Ingrese un correo válido.</div>
                        }
                        @if (email?.hasError("invalidLength")) {
                          <div>Debe tener entre 6 y 80 caracteres.</div>
                        }
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 d-flex align-items-center">
                    <div class="form-check form-switch ms-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="enabled"
                        formControlName="enabled"
                      />
                      <label class="form-check-label ms-2" for="enabled">
                        Cliente activo
                      </label>
                    </div>
                  </div>
                </div>

                <div class="row g-3 mt-1" formGroupName="address">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        id="street"
                        placeholder="Calle principal"
                        formControlName="street"
                        [ngClass]="{
                          'is-invalid':
                            street?.invalid &&
                            (street?.dirty || street?.touched),
                        }"
                      />
                      <label for="street"
                        ><i class="bi bi-geo-alt me-2"></i>Calle
                        principal</label
                      >
                      <div class="invalid-feedback">
                        @if (street?.hasError("required")) {
                          <div>La calle es requerida.</div>
                        }
                        @if (street?.hasError("invalidLength")) {
                          <div>Debe tener entre 5 y 80 caracteres.</div>
                        }
                        @if (street?.hasError("whitespace")) {
                          <div>No se permiten espacios en blanco.</div>
                        }
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        id="number"
                        placeholder="Número"
                        formControlName="number"
                        [ngClass]="{
                          'is-invalid':
                            number?.invalid &&
                            (number?.dirty || number?.touched),
                        }"
                      />
                      <label for="number"
                        ><i class="bi bi-hash me-2"></i>Número</label
                      >
                      <div class="invalid-feedback">
                        @if (number?.hasError("required")) {
                          <div>El número es requerido.</div>
                        }
                        @if (number?.hasError("invalidLength")) {
                          <div>Debe tener entre 1 y 10 caracteres.</div>
                        }
                        @if (number?.hasError("whitespace")) {
                          <div>No se permiten espacios en blanco.</div>
                        }
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        id="city"
                        placeholder="Ciudad"
                        formControlName="city"
                        [ngClass]="{
                          'is-invalid':
                            city?.invalid && (city?.dirty || city?.touched),
                        }"
                      />
                      <label for="city"
                        ><i class="bi bi-geo me-2"></i>Ciudad</label
                      >
                      <div class="invalid-feedback">
                        @if (city?.hasError("required")) {
                          <div>La ciudad es requerida.</div>
                        }
                        @if (city?.hasError("invalidLength")) {
                          <div>Debe tener entre 3 y 60 caracteres.</div>
                        }
                        @if (city?.hasError("whitespace")) {
                          <div>No se permiten espacios en blanco.</div>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </form>
          </div>
          <div class="card-footer client-form-footer text-end border-top-0">
            <button
              type="button"
              class="btn btn-secondary me-2"
              (click)="onCancel()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              (click)="onSubmit()"
              [disabled]="formGroup.invalid || isSubmitting"
            >
              @if (isSubmitting) {
                <span
                  class="spinner-border spinner-border-sm me-2"
                  aria-hidden="true"
                ></span>
              } @else {
                <i
                  class="bi me-1"
                  [class]="isEditMode ? 'bi-save' : 'bi-check-circle'"
                ></i>
              }
              {{ isEditMode ? "Guardar Cambios" : "Confirmar Registro" }}
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
